<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="de">
<head>
<!-- Generated by javadoc (1.8.0_151) on Mon Jan 13 10:47:43 CET 2020 -->
<title>FIDOCCImplementation</title>
<meta name="date" content="2020-01-13">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="FIDOCCImplementation";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10,"i3":10,"i4":10,"i5":10,"i6":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../de/tsenger/u2f/package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/FIDOCCImplementation.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../de/tsenger/u2f/Bool.html" title="class in de.tsenger.u2f"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../de/tsenger/u2f/Secp256r1.html" title="class in de.tsenger.u2f"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?de/tsenger/u2f/FIDOCCImplementation.html" target="_top">Frames</a></li>
<li><a href="FIDOCCImplementation.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">de.tsenger.u2f</div>
<h2 title="Class FIDOCCImplementation" class="title">Class FIDOCCImplementation</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>de.tsenger.u2f.FIDOCCImplementation</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="typeNameLabel">FIDOCCImplementation</span>
extends java.lang.Object</pre>
<dl>
<dt><span class="simpleTagLabel">Version:</span></dt>
<dd>1.34</dd>
<dt><span class="simpleTagLabel">Author:</span></dt>
<dd>Tobias Senger</dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static javacard.security.MessageDigest</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#blindingSHA">blindingSHA</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static javacard.security.KeyAgreement</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#ecMultiplyHelper">ecMultiplyHelper</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static javacard.security.AESKey</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#inputBlindingBlock">inputBlindingBlock</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static javacard.security.AESKey</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#kdfSeed">kdfSeed</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static javacard.security.Signature</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#kdFunction">kdFunction</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static javacard.security.KeyPair</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#keyPair">keyPair</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static javacard.security.Signature</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#macFunction">macFunction</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static javacard.security.AESKey</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#macKey">macKey</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static javacard.security.RandomData</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#random">random</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static byte[]</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#scratch">scratch</a></span></code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#FIDOCCImplementation--">FIDOCCImplementation</a></span>()</code>
<div class="block">constructor for FIDO crypto functions.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>private short</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#calcMAC-byte:A-short-byte:A-short-byte:A-short-">calcMAC</a></span>(byte[]&nbsp;applicationParameter,
       short&nbsp;applicationParameterOffset,
       byte[]&nbsp;nonceBuffer,
       short&nbsp;nonceBufferOffset,
       byte[]&nbsp;mac,
       short&nbsp;macOffset)</code>
<div class="block">Calculates 32 Byte MAC over given applicationParameter and given nonce.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>short</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#eraseKeys-short-">eraseKeys</a></span>(short&nbsp;actualState)</code>
<div class="block">Clears the KDF seed key and the MAC key and the inputBlindingBlock
 This method will only clear the keys if the actual state is .</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#generatePrivateKey-byte:A-short-byte:A-short-javacard.security.ECPrivateKey-">generatePrivateKey</a></span>(byte[]&nbsp;applicationParameter,
                  short&nbsp;applicationParameterOffset,
                  byte[]&nbsp;nonceBuffer,
                  short&nbsp;nonceBufferOffset,
                  javacard.security.ECPrivateKey&nbsp;privKey)</code>
<div class="block">Generates a private ECDSA Key (on curve secp256r1) based on on the given input parameters applicationParameter and nonce.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>private short</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#generatePublicKeyPoint-javacard.security.ECPrivateKey-byte:A-short-">generatePublicKeyPoint</a></span>(javacard.security.ECPrivateKey&nbsp;privKey,
                      byte[]&nbsp;pointOutputBuffer,
                      short&nbsp;offset)</code>
<div class="block">Generate Public Key from given Private Key.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>short</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#getPubKeyAndKeyHandle-byte:A-short-byte:A-short-byte:A-short-">getPubKeyAndKeyHandle</a></span>(byte[]&nbsp;applicationParameter,
                     short&nbsp;applicationParameterOffset,
                     byte[]&nbsp;publicKey,
                     short&nbsp;publicKeyOffset,
                     byte[]&nbsp;keyHandle,
                     short&nbsp;keyHandleOffset)</code>
<div class="block">Generates FIDO User Public Key and FIDO KeyHandle with the given parameters
 This method will first generate 32 byte nonce for the keyHandle by using <code>RandomData.generateData(byte[], short, short)</code>.</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>short</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#getSigningKey-byte:A-short-short-byte:A-short-javacard.security.ECPrivateKey-">getSigningKey</a></span>(byte[]&nbsp;keyHandle,
             short&nbsp;keyHandleOffset,
             short&nbsp;keyHandleLength,
             byte[]&nbsp;applicationParameter,
             short&nbsp;applicationParameterOffset,
             javacard.security.ECPrivateKey&nbsp;regeneratedPrivateKey)</code>
<div class="block">Generates the FIDO private key with the given parameters.</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>short</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#initializeKeys-short-">initializeKeys</a></span>(short&nbsp;actualState)</code>
<div class="block">Initialize KDF Seed Key, the MAC key and the inputBlindingBlock.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="keyPair">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>keyPair</h4>
<pre>private static&nbsp;javacard.security.KeyPair keyPair</pre>
</li>
</ul>
<a name="kdfSeed">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>kdfSeed</h4>
<pre>private static&nbsp;javacard.security.AESKey kdfSeed</pre>
</li>
</ul>
<a name="macKey">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>macKey</h4>
<pre>private static&nbsp;javacard.security.AESKey macKey</pre>
</li>
</ul>
<a name="random">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>random</h4>
<pre>private static&nbsp;javacard.security.RandomData random</pre>
</li>
</ul>
<a name="scratch">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>scratch</h4>
<pre>private static&nbsp;byte[] scratch</pre>
</li>
</ul>
<a name="ecMultiplyHelper">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>ecMultiplyHelper</h4>
<pre>private static&nbsp;javacard.security.KeyAgreement ecMultiplyHelper</pre>
</li>
</ul>
<a name="kdFunction">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>kdFunction</h4>
<pre>private static&nbsp;javacard.security.Signature kdFunction</pre>
</li>
</ul>
<a name="macFunction">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>macFunction</h4>
<pre>private static&nbsp;javacard.security.Signature macFunction</pre>
</li>
</ul>
<a name="inputBlindingBlock">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>inputBlindingBlock</h4>
<pre>private static&nbsp;javacard.security.AESKey inputBlindingBlock</pre>
</li>
</ul>
<a name="blindingSHA">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>blindingSHA</h4>
<pre>private static&nbsp;javacard.security.MessageDigest blindingSHA</pre>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="FIDOCCImplementation--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>FIDOCCImplementation</h4>
<pre>public&nbsp;FIDOCCImplementation()</pre>
<div class="block">constructor for FIDO crypto functions. Following steps will be performed during instantiation:
 <ul>
                <li> 
                initialize random number generator (DRNG according SP800-90A (DRG.4)) 
                </li>
                <li>
                initialize transient byte array as buffer for different operations
                </li>
                <li>
                initialize <code>KeyPair</code> for storing deviated FIDO keys 
                </li>
                <li>
                initialize  <code>AESKey</code> object for seed used in KDF 
                </li>
                <li>
                get CMAC <code>Signature</code> instance for KDF 
                </li>
                <li>
                initialize <code>AESKey</code> object for MACKey used for MAC
                </li>
                <li>
                get CMAC <code>Signature</code> instance for MAC
                </li>
                <li>
                get <a href="file:/home/tsenger/eclipse-javacard-workspace/de.fac2/applet/extlibs/SecureMessaging2.0/docs/html/com/gieseckedevrient/javacard/libraries/securemessaging/GDKeyAgreement.html?is-external=true" title="class or interface in com.gieseckedevrient.javacard.libraries.securemessaging"><code>GDKeyAgreement</code></a> instance for EC point multiplication used for FIDO public key generation
                </li>
                <li>
                initialize <code>AESKey</code> object for storing input blinding block
                </li>
                <li>
                get <code>MessageDigest</code> instance with algorithm <a href="file:/home/tsenger/eclipse-javacard-workspace/de.fac2/applet/extlibs/GenericCrypto1.1/docs/html/com/gieseckedevrient/javacard/libraries/genericcrypto/GenericCryptoFactory.html?is-external=true#ALG_SEC_SHA256" title="class or interface in com.gieseckedevrient.javacard.libraries.genericcrypto"><code>GenericCryptoFactory.ALG_SEC_SHA256</code></a> for secure SHA256 output blinding
                </li>
 </ul></div>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="initializeKeys-short-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>initializeKeys</h4>
<pre>public&nbsp;short&nbsp;initializeKeys(short&nbsp;actualState)</pre>
<div class="block">Initialize KDF Seed Key, the MAC key and the inputBlindingBlock.
 Only initialize the keys if the given actual state is . Otherwise doesn't touch any keys. 
 The keys are generated by filling the key objects with random data from platforms TRNG using the function <code>RandomData.generateData(byte[], short, short)</code>.
 After setting the random key values into the key objects the transients scratch which was used as temporary key buffer is cleared by filling it with zeros using the method
 <a href="file:/home/tsenger/eclipse-javacard-workspace/de.fac2/applet/extlibs/DGSecurity1.1/docs/html/com/gieseckedevrient/javacard/libraries/security/Security.html?is-external=true#arrayFill-java.lang.Object-short-short-short-" title="class or interface in com.gieseckedevrient.javacard.libraries.security"><code>Security.arrayFill(Object, short, short, short)</code></a>
 The key generation and clearing of the scratch is a transaction which will be perform complete or canceled (no keys are touched) if any unexpected error occurs.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>actualState</code> - expects the actual security state of the applet (from class States)</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>new security state,  if successful initialized keys otherwise the given actual state (parameter actualState)</dd>
</dl>
</li>
</ul>
<a name="eraseKeys-short-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>eraseKeys</h4>
<pre>public&nbsp;short&nbsp;eraseKeys(short&nbsp;actualState)</pre>
<div class="block">Clears the KDF seed key and the MAC key and the inputBlindingBlock
 This method will only clear the keys if the actual state is . Otherwise the keys keeps untouched.
 The clearing of the keys is performed one transaction by using the platforms method <code>Key.clearKey()</code>. If all keys are cleared this method will return the new state </div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>actualState</code> - actualState expects the actual security state of the applet. Only clears keys if given actual state is </dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>new security state,  if successful cleared keys otherwise the given actual state (parameter actualState)</dd>
</dl>
</li>
</ul>
<a name="getPubKeyAndKeyHandle-byte:A-short-byte:A-short-byte:A-short-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getPubKeyAndKeyHandle</h4>
<pre>public&nbsp;short&nbsp;getPubKeyAndKeyHandle(byte[]&nbsp;applicationParameter,
                                   short&nbsp;applicationParameterOffset,
                                   byte[]&nbsp;publicKey,
                                   short&nbsp;publicKeyOffset,
                                   byte[]&nbsp;keyHandle,
                                   short&nbsp;keyHandleOffset)</pre>
<div class="block">Generates FIDO User Public Key and FIDO KeyHandle with the given parameters
 This method will first generate 32 byte nonce for the keyHandle by using <code>RandomData.generateData(byte[], short, short)</code>. Then the FIDO EC private key will be generated by calling the method <a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#generatePrivateKey-byte:A-short-byte:A-short-javacard.security.ECPrivateKey-"><code>generatePrivateKey(byte[], short, byte[], short, ECPrivateKey)</code></a>
 with the generate nonce and the parameter applicationParameter as input. The returned FIDO EC private key will be used to generate the FIDO EC public key by calling the method <a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#generatePublicKeyPoint-javacard.security.ECPrivateKey-byte:A-short-"><code>generatePublicKeyPoint(ECPrivateKey, byte[], short)</code></a>
 After generating the public key, the private key will be securely cleared by using method <code>Key.clearKey()</code>. Then the MAC over the applicationParameter and the nonce will be generated by calling the 
 method <a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#calcMAC-byte:A-short-byte:A-short-byte:A-short-"><code>calcMAC(byte[], short, byte[], short, byte[], short)</code></a>. The returned key handle is the nonce and the MAC over applicationParameter and nonce.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>applicationParameter</code> - byte array that contains concatenated 32 bytes application parameter as specified in FIDO U2F Raw Message Formats</dd>
<dd><code>applicationParameterOffset</code> - offset in byte array where applicationParamter starts</dd>
<dd><code>publicKey</code> - byte array that returns the FIDO User Public Key</dd>
<dd><code>publicKeyOffset</code> - offset in byte array where FIDO User Public Key starts</dd>
<dd><code>keyHandle</code> - byte array that returns the FIDO key handle</dd>
<dd><code>keyHandleOffset</code> - offset in byte array where FIDO key handle starts</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>key handle length (fixed length 64)</dd>
</dl>
</li>
</ul>
<a name="getSigningKey-byte:A-short-short-byte:A-short-javacard.security.ECPrivateKey-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getSigningKey</h4>
<pre>public&nbsp;short&nbsp;getSigningKey(byte[]&nbsp;keyHandle,
                           short&nbsp;keyHandleOffset,
                           short&nbsp;keyHandleLength,
                           byte[]&nbsp;applicationParameter,
                           short&nbsp;applicationParameterOffset,
                           javacard.security.ECPrivateKey&nbsp;regeneratedPrivateKey)</pre>
<div class="block">Generates the FIDO private key with the given parameters. KDF will be only executed if MAC verifies.
 This method will first check if the MAC in key KeyHandle is correct by calculating the MAC over applicationParameter and nonce with method <a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#calcMAC-byte:A-short-byte:A-short-byte:A-short-"><code>calcMAC(byte[], short, byte[], short, byte[], short)</code></a>.
 Then the given MAC is compared with the calculated MAC by using the method <a href="file:/home/tsenger/eclipse-javacard-workspace/de.fac2/applet/extlibs/DGSecurity1.1/docs/html/com/gieseckedevrient/javacard/libraries/security/Security.html?is-external=true#secureCompare-java.lang.Object-short-java.lang.Object-short-short-" title="class or interface in com.gieseckedevrient.javacard.libraries.security"><code>Security.secureCompare(Object, short, Object, short, short)</code></a>. Only if the MACs are equal the FIDO EC private key is generate by 
 calling method <a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#generatePrivateKey-byte:A-short-byte:A-short-javacard.security.ECPrivateKey-"><code>generatePrivateKey(byte[], short, byte[], short, ECPrivateKey)</code></a> with the given applicationParameter and the nonce from the given keyHandle. 
 The private key will be returned to the calling method in parameter regeneratedPrivateKey</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>keyHandle</code> - byte array that keeps the FIDO key handle</dd>
<dd><code>keyHandleOffset</code> - offset in byte array where FIDO key handle starts</dd>
<dd><code>keyHandleLength</code> - length of key handle</dd>
<dd><code>applicationParameter</code> - byte array that contains 32 bytes application parameter as specified in FIDO U2F Raw Message Formats</dd>
<dd><code>applicationParameterOffset</code> - offset in byte array where applicationParamter starts</dd>
<dd><code>regeneratedPrivateKey</code> - ECPrivateKey object will be filled with the calculated FIDO EC private key</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>returns false if MAC couldn't verified. Then the private EC will not be calculated. Otherwise true will be returned and regeneratedPrivateKey will be filled.</dd>
</dl>
</li>
</ul>
<a name="generatePublicKeyPoint-javacard.security.ECPrivateKey-byte:A-short-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>generatePublicKeyPoint</h4>
<pre>private&nbsp;short&nbsp;generatePublicKeyPoint(javacard.security.ECPrivateKey&nbsp;privKey,
                                     byte[]&nbsp;pointOutputBuffer,
                                     short&nbsp;offset)</pre>
<div class="block">Generate Public Key from given Private Key. 
 This function uses the the <code>KeyAgreement.generateSecret(byte[], short, short, byte[], short)</code> method using <a href="file:/home/tsenger/eclipse-javacard-workspace/de.fac2/applet/extlibs/SecureMessaging2.0/docs/html/com/gieseckedevrient/javacard/libraries/securemessaging/GDKeyAgreement.html?is-external=true#ALG_EC_SVDP_DH_PLAIN_XY" title="class or interface in com.gieseckedevrient.javacard.libraries.securemessaging"><code>GDKeyAgreement.ALG_EC_SVDP_DH_PLAIN_XY</code></a> for getting public key to the given private key.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>privKey</code> - Private Key object</dd>
<dd><code>pointOutputBuffer</code> - Output buffer for Public Key as uncompressed EC point</dd>
<dd><code>offset</code> - Offset in the output buffer where Public key begins</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>Length size of generated Public Key</dd>
</dl>
</li>
</ul>
<a name="generatePrivateKey-byte:A-short-byte:A-short-javacard.security.ECPrivateKey-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>generatePrivateKey</h4>
<pre>private&nbsp;void&nbsp;generatePrivateKey(byte[]&nbsp;applicationParameter,
                                short&nbsp;applicationParameterOffset,
                                byte[]&nbsp;nonceBuffer,
                                short&nbsp;nonceBufferOffset,
                                javacard.security.ECPrivateKey&nbsp;privKey)</pre>
<div class="block">Generates a private ECDSA Key (on curve secp256r1) based on on the given input parameters applicationParameter and nonce. 
 This method uses the method <code>Signature.sign(byte[], short, short, byte[], short)</code> initialized with <code>Signature.SIG_CIPHER_AES_MAC128</code> for key derivation. 
 The first input block for AES CMAC will be blinded with a secret <a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#inputBlindingBlock"><code>inputBlindingBlock</code></a> to avoid known plaintext attacks to the AES engine. 
 To get 32 byte EC private key from AES 128 CMAC (which will only return 16 Byte) we will use two rounds of CMAC with different counter as additional input which is 
 know as KDF in counter method.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>applicationParameter</code> - byte array with AppID data from relaying party</dd>
<dd><code>applicationParameterOffset</code> - offset in byte array where AppID data starts</dd>
<dd><code>nonceBuffer</code> - byte array with nonce</dd>
<dd><code>nonceBufferOffset</code> - offset in byte array where nonce start</dd>
<dd><code>privKey</code> - expects an initialized (set curve parameter) ECPrivateKey object and fills this object with the secret key component S</dd>
</dl>
</li>
</ul>
<a name="calcMAC-byte:A-short-byte:A-short-byte:A-short-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>calcMAC</h4>
<pre>private&nbsp;short&nbsp;calcMAC(byte[]&nbsp;applicationParameter,
                      short&nbsp;applicationParameterOffset,
                      byte[]&nbsp;nonceBuffer,
                      short&nbsp;nonceBufferOffset,
                      byte[]&nbsp;mac,
                      short&nbsp;macOffset)</pre>
<div class="block">Calculates 32 Byte MAC over given applicationParameter and given nonce. 
 This method uses the method <code>Signature.sign(byte[], short, short, byte[], short)</code> initialized with <code>Signature.SIG_CIPHER_AES_MAC128</code> for MAC calculation. 
 The first input block for AES CMAC will be blinded with a secret <a href="../../../de/tsenger/u2f/FIDOCCImplementation.html#inputBlindingBlock"><code>inputBlindingBlock</code></a> to avoid known plaintext attacks to the AES engine. 
 To get 32 byte MAC from AES 128 CMAC (which will only return 16 Byte) we will use two rounds of CMAC with different counter as additional input which is 
 know as KDF in counter method. The 32 Byte MAC will post processed by calculating the SHA256 value of this MAC to avoid know cipher text attacks to the AES engine.
 A secure SHA256 implementation is used by calling method <code>MessageDigest.doFinal(byte[], short, short, byte[], short)</code> initialized with <a href="file:/home/tsenger/eclipse-javacard-workspace/de.fac2/applet/extlibs/GenericCrypto1.1/docs/html/com/gieseckedevrient/javacard/libraries/genericcrypto/GenericCryptoFactory.html?is-external=true#ALG_SEC_SHA256" title="class or interface in com.gieseckedevrient.javacard.libraries.genericcrypto"><code>GenericCryptoFactory.ALG_SEC_SHA256</code></a></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>applicationParameter</code> - array that stores the application parameter (AppID)</dd>
<dd><code>applicationParameterOffset</code> - offset in array where application parameter (AppID) starts</dd>
<dd><code>nonceBuffer</code> - array that stores the nonce</dd>
<dd><code>nonceBufferOffset</code> - offset in array where nonce starts</dd>
<dd><code>mac</code> - array to store the result</dd>
<dd><code>macOffset</code> - offset in array where result shall starts</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>size of MAC in bytes (always 32)</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../de/tsenger/u2f/package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/FIDOCCImplementation.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../de/tsenger/u2f/Bool.html" title="class in de.tsenger.u2f"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../de/tsenger/u2f/Secp256r1.html" title="class in de.tsenger.u2f"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?de/tsenger/u2f/FIDOCCImplementation.html" target="_top">Frames</a></li>
<li><a href="FIDOCCImplementation.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
